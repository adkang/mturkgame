<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
	<head>
		<script src="text/javascript"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="mturk.js"></script>
    		<script>
			var shipx = 0;
			var board =
  				[[0,0,0,1,0,0],
   				[0,0,0,0,1,1],
   				[1,1,1,0,0,1],
   				[1,1,0,0,0,0],
   				[0,0,0,0,0,0],
   				[0,0,1,0,0,0],
   				[0,1,0,0,0,0]];
   			var GameOver = 0
   			var time = 0

			$(document).ready(function() {
 			 var gameboard = $("<div id='gameboard'></div>");
			 $(document.body).append(gameboard);
			 
			 // function makeBoard() {
   				for (var i = 0; i < board.length - 1; i++) {
			  		for (var j = 0; j < board[0].length; j++) {
						var gridcellid = 'gridcell_' + i + '_' + j;
						var cell = $("<div class='gridcell' id='newcell'></div>");
						$(gameboard).append(cell);
						$('#newcell').css("left", (50 * j) + "px");
						$('#newcell').css("top", (50 * i) + "px");
						$("#newcell").attr("id", gridcellid);
					}
				}
			// }

			 var ship = $("<div class='ship'></div>");
			 $(gameboard).append(ship);
				
			  $(document).keydown(function(e) {
 			   if(e.keyCode==37) {
 			     // left arrow clicked
 			     if (shipx == 0) {
 			     	shipx = board[0].length - 1;
 			     }
			     else {
			     	shipx -= 1;
			     }
 			   } else if(e.keyCode == 39) {
 			     // right arrow clicked
 			     if (shipx == board[0].length - 1) {
 			      	shipx = 0; 
 			      }
			     else {
			      	shipx += 1; 
			      }
			    }	  
			    $(".ship").css("left", (50 * shipx) + "px");
			  });
				
			  setInterval(function() {
			  	if (GameOver == 0) {
			     if (time == 2000) {
			       	endGame(time);
			    	GameOver = 1;
			     } 
			     var offset = Math.floor(time) % board.length;
			     for (var x = 0; x < board.length - 1; x++) {
			     	for (var y = 0; y < board[0].length; y++) {
				 		var off = x - offset;
						if (off < 0) {
							off = off + board.length;
						}
						var cellid = 'gridcell_' + x + '_' + y;
						if (board[off][y] == 1) {
							$('#'+cellid).css("background-color", "blue");
							if (x == board.length - 2 && y == shipx) {
							 	endGame(time);
							 	GameOver = 1;
							 }
						}
						else {
							$('#'+cellid).css("background-color", "gray");
						}
					}
			     }
			     time += 0.5
				}
			  }, 500);
				
			function endGame(time) {
				var reward = time * 0.001;
				alert("You scored $" + reward + ". Thank you for playing.")
			}
			})
			</script>
			<style>
				
			#gameboard {
			  background-color: gray;
			  width: 300px;
			  height: 300px;
			  position: relative;
			}
			.ship {
			  background-color: red;
			  width: 50px;
			  height: 50px;
			  position: absolute;
			  left: 0px;
			  top: 250px;
			}
			.gridcell {
			  width: 50px;
			  height: 50px;
			  position: absolute;
			}
			</style>
  	</head>
  <body>
	<form is="mturk_form">
		  
	<input type="hidden" name="bonus">
	  </form>
  </body>
</html>
